-- Problem 20: Stored Procedure to categorize student grades and
-- a PL/SQL block to call it.

-- --- Setup ---
-- Run this once to create the tables.
/*
CREATE TABLE Stud_Marks(
  Roll NUMBER PRIMARY KEY,
  Name VARCHAR2(100),
  total_marks NUMBER
);

CREATE TABLE Result(
  Roll NUMBER,
  Name VARCHAR2(100),
  Class VARCHAR2(50)
);

-- Sample Data
INSERT INTO Stud_Marks VALUES (1, 'Alice', 1000);
INSERT INTO Stud_Marks VALUES (2, 'Bob', 950);
INSERT INTO Stud_Marks VALUES (3, 'Charlie', 850);
INSERT INTO Stud_Marks VALUES (4, 'David', 700);
COMMIT;
*/

-- --- 1. Stored Procedure Definition ---
CREATE OR REPLACE PROCEDURE proc_Grade (
  p_roll        IN Stud_Marks.Roll%TYPE,
  p_name        IN Stud_Marks.Name%TYPE,
  p_total_marks IN Stud_Marks.total_marks%TYPE
)
IS
  v_class Result.Class%TYPE;
BEGIN
  -- Categorize the student based on marks
  IF p_total_marks <= 1500 AND p_total_marks >= 990 THEN
    v_class := 'Distinction';
  ELSIF p_total_marks <= 989 AND p_total_marks >= 900 THEN
    v_class := 'First Class';
  ELSIF p_total_marks <= 899 AND p_total_marks >= 825 THEN
    v_class := 'Higher Second Class';
  ELSE
    v_class := 'No Category'; -- Handle other cases
  END IF;

  -- Insert the result into the Result table
  INSERT INTO Result (Roll, Name, Class)
  VALUES (p_roll, p_name, v_class);
  
EXCEPTION
  WHEN OTHERS THEN
    DBMS_OUTPUT.PUT_LINE('Error in proc_Grade: ' || SQLERRM);
END proc_Grade;
/

-- --- 2. PL/SQL Block to Use the Procedure ---
SET SERVEROUTPUT ON;

DECLARE
  -- Cursor to get all students from the marks table
  CURSOR c_students IS
    SELECT Roll, Name, total_marks FROM Stud_Marks;
    
BEGIN
  -- Clear the result table before running (optional)
  DELETE FROM Result;
  DBMS_OUTPUT.PUT_LINE('Categorizing students...');

  -- Loop through each student
  FOR student_rec IN c_students LOOP
    -- Call the stored procedure for each student
    proc_Grade(student_rec.Roll, student_rec.Name, student_rec.total_marks);
  END LOOP;
  
  COMMIT;
  DBMS_OUTPUT.PUT_LINE('Student categorization complete.');
  DBMS_OUTPUT.PUT_LINE('Check the Result table to see the output.');

EXCEPTION
  WHEN OTHERS THEN
    DBMS_OUTPUT.PUT_LINE('An error occurred: ' || SQLERRM);
    ROLLBACK;
END;
/

-- To see the results:
-- SELECT * FROM Result;