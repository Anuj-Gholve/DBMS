-- Create Tables
CREATE TABLE Branch (
    branch_name VARCHAR(50) PRIMARY KEY,
    branch_city VARCHAR(50) NOT NULL,
    assets DECIMAL(12,2) NOT NULL
);

CREATE TABLE Account (
    acc_no INT PRIMARY KEY,
    branch_name VARCHAR(50),
    balance DECIMAL(12,2) NOT NULL,
    FOREIGN KEY (branch_name) REFERENCES Branch(branch_name)
);

CREATE TABLE Customer (
    cust_name VARCHAR(50) PRIMARY KEY,
    cust_street VARCHAR(100),
    cust_city VARCHAR(50)
);

CREATE TABLE Depositor (
    cust_name VARCHAR(50),
    acc_no INT,
    PRIMARY KEY (cust_name, acc_no),
    FOREIGN KEY (cust_name) REFERENCES Customer(cust_name),
    FOREIGN KEY (acc_no) REFERENCES Account(acc_no)
);

CREATE TABLE Loan (
    loan_no INT PRIMARY KEY,
    branch_name VARCHAR(50),
    amount DECIMAL(12,2),
    FOREIGN KEY (branch_name) REFERENCES Branch(branch_name)
);

CREATE TABLE Borrower (
    cust_name VARCHAR(50),
    loan_no INT,
    PRIMARY KEY (cust_name, loan_no),
    FOREIGN KEY (cust_name) REFERENCES Customer(cust_name),
    FOREIGN KEY (loan_no) REFERENCES Loan(loan_no)
);

-- Insert Sample Data
INSERT INTO Branch VALUES
('Pune_Station', 'Pune', 900000),
('Camp', 'Pune', 800000),
('Deccan', 'Pune', 700000);

INSERT INTO Account VALUES
(101, 'Pune_Station', 25000),
(102, 'Camp', 18000),
(103, 'Deccan', 30000),
(104, 'Pune_Station', 20000);

INSERT INTO Customer VALUES
('Anuj', 'MG Road', 'Pune'),
('Riya', 'FC Road', 'Pune'),
('Amit', 'JM Road', 'Pune'),
('Sara', 'Laxmi Road', 'Pune'),
('Karan', 'Baner', 'Pune');

INSERT INTO Depositor VALUES
('Anuj', 101),
('Riya', 102),
('Amit', 103),
('Karan', 104);

INSERT INTO Loan VALUES
(201, 'Pune_Station', 15000),
(202, 'Deccan', 20000),
(203, 'Camp', 18000);

INSERT INTO Borrower VALUES
('Anuj', 201),
('Sara', 202),
('Riya', 203);

-- QUERIES

-- 1. Create View1 to display customers in alphabetical order having loan from Pune_Station branch
CREATE VIEW View1 AS
SELECT DISTINCT c.cust_name
FROM Customer c
JOIN Borrower b ON c.cust_name = b.cust_name
JOIN Loan l ON b.loan_no = l.loan_no
WHERE l.branch_name = 'Pune_Station'
ORDER BY c.cust_name ASC;

-- 2. Create View2 on Branch table (two columns) and perform insert, update, delete
CREATE VIEW View2 AS
SELECT branch_name, branch_city FROM Branch;

-- Insert into View2
INSERT INTO Branch (branch_name, branch_city, assets) VALUES ('Kothrud', 'Pune', 600000);

-- Update using View2
UPDATE Branch SET branch_city = 'Mumbai' WHERE branch_name = 'Camp';

-- Delete using View2
DELETE FROM Branch WHERE branch_name = 'Deccan';

-- 3. Create View3 on Borrower and Depositor (one column from each) and perform insert, update, delete
CREATE VIEW View3 AS
SELECT b.cust_name AS borrower_name, d.acc_no AS depositor_acc
FROM Borrower b
JOIN Depositor d ON b.cust_name = d.cust_name;

-- Insert (via base tables)
INSERT INTO Borrower VALUES ('Karan', 203);
INSERT INTO Depositor VALUES ('Sara', 102);

-- Update (via base tables)
UPDATE Borrower SET loan_no = 202 WHERE cust_name = 'Karan';

-- Delete (via base tables)
DELETE FROM Borrower WHERE cust_name = 'Sara';

-- 4. Create UNION of left and right join for customers having account or loan or both
SELECT DISTINCT c.cust_name
FROM Customer c
LEFT JOIN Depositor d ON c.cust_name = d.cust_name
LEFT JOIN Borrower b ON c.cust_name = b.cust_name
UNION
SELECT DISTINCT c.cust_name
FROM Customer c
RIGHT JOIN Depositor d ON c.cust_name = d.cust_name
RIGHT JOIN Borrower b ON c.cust_name = b.cust_name;

-- 5. Create Simple and Unique Index
CREATE INDEX idx_branch_city ON Branch(branch_city);         -- Simple index
CREATE UNIQUE INDEX idx_customer_name ON Customer(cust_name); -- Unique index

-- 6. Display Index Information
-- For MySQL:
SHOW INDEX FROM Branch;
SHOW INDEX FROM Customer;

-- For PostgreSQL:
-- \d Branch;
-- \d Customer;
